# にらめっこアプリ 要件定義書

**作成日**: 2025-11-07  
**アプリ名**: にらめっこ（仮）  
**使用技術**: Flutter, Firebase, MediaPipe

---

## 📌 概要

オンライン上で1対1のにらめっこ対決を行うアプリ。  
絵文字やエフェクトを活用し、MediaPipeで笑顔判定を行い勝負をつける。

---

## 🎯 ターゲット・用途

- **想定ユーザー層**: ライトユーザー、カジュアルゲーマー
- **対応プラットフォーム**: iOS, Android
- **利用環境**: スマートフォン（フロントカメラ使用）
- **利用シーン**: 暇つぶし

---

## 🎮 対戦形式

### マッチング方式
- **ランダムマッチング**

### 接続方式
- **リアルタイム対戦**（同時接続）

### ゲーム時間
- **1ゲームあたり60秒**

---

## 😊 笑顔判定仕様

### 判定基準
- MediaPipeの笑顔判定を使用
- 具体的な閾値は実装時に調整

### 判定タイミング
- **常時監視**

### 勝敗判定
- **笑った時点で即座に勝負終了**

### フェイルセーフ
- **顔検出失敗時の処理**:
  - カウントダウン警告（3秒以内に顔を戻さないと負け）
  - Firebaseの更新が止まって3秒経過 → 自動的に負け判定
  - いかなるアクシデント（カメラ隠し、画面外、通信遅延など）でも同様の処理

---

## 🎨 絵文字・エフェクト機能

### 対戦中のリアルタイムエフェクト

#### 表示方式
- **案A採用**: 相手の画面全体にポップアップ表示（大きく目立つ）

#### 送信制限
- **連打防止**: クールタイム制を導入
- **動的クールタイム**:
  - 序盤: クールタイム長め
  - 時間経過とともにクールタイムを短縮

#### 絵文字の種類
- **方針**: 多ければ多いほど良い
- **選択方式**: 複数ある中から数個だけ選択してそれだけで戦う形式も検討

#### 使用条件
- **両者が使える** クールタイムが経過したら送信可能

### 勝敗後の演出

- **勝者側**: 紙吹雪アニメーション + 「Victory!」テキスト（Lottieアニメーション使用）
- **敗者側**: 画面が少し暗くなる + 「Defeat...」テキスト
- **引き分け**: 「Draw」表示のみ

---

## 👤 認証・ユーザー管理

### ログイン方式
- **匿名認証**（Firebase Anonymous Authentication）

### プロフィール
- **ニックネーム**のみ設定可能

---

## 💰 マネタイズ

- **収益モデル**: 完全無料

---

## 🏆 ランキング機能

### ランキングの種類
- **全体ランキング**

### 表示情報
- **ニックネーム**
- **勝利数**
- **勝率**（勝利数 / 総対戦数）

### データ管理
- **Firestoreでリアルタイム集計**
